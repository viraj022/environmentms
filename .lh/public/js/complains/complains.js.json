{
    "sourceFile": "public/js/complains/complains.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 6,
            "patches": [
                {
                    "date": 1648112032055,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1648112037949,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -26,9 +26,9 @@\n         \"ajax\": {\n             \"url\": \"/api/get_complain_data/\",\n             \"type\": \"GET\",\n             \"dataSrc\": \"\"\n-            \n+            'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content'),\n         },\n         \"columns\": [{\n                 \"data\": \"\"\n             },\n"
                },
                {
                    "date": 1648112137249,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,9 +6,8 @@\n     $('#complainer_code').val(date + '/' + prs + '/' + code);\n }\n \n function load_complains() {\n-    let url = '/api/complain_data';\n     let index = 1;\n     complain_list = $('#complain_tbl').DataTable({\n         \"destroy\": true,\n         \"processing\": true,\n@@ -25,9 +24,9 @@\n         },\n         \"ajax\": {\n             \"url\": \"/api/get_complain_data/\",\n             \"type\": \"GET\",\n-            \"dataSrc\": \"\"\n+            \"dataSrc\": \"\",\n             'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content'),\n         },\n         \"columns\": [{\n                 \"data\": \"\"\n"
                },
                {
                    "date": 1648112259832,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,9 +22,9 @@\n         language: {\n             searchPlaceholder: \"Search...\"\n         },\n         \"ajax\": {\n-            \"url\": \"/api/get_complain_data/\",\n+            \"url\": \"/api/get_complain_dataa/\",\n             \"type\": \"GET\",\n             \"dataSrc\": \"\",\n             'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content'),\n         },\n"
                },
                {
                    "date": 1648112270209,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,9 +22,9 @@\n         language: {\n             searchPlaceholder: \"Search...\"\n         },\n         \"ajax\": {\n-            \"url\": \"/api/get_complain_dataa/\",\n+            \"url\": \"/api/get_complain_data/\",\n             \"type\": \"GET\",\n             \"dataSrc\": \"\",\n             'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content'),\n         },\n"
                },
                {
                    "date": 1648112382985,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -24,10 +24,10 @@\n         },\n         \"ajax\": {\n             \"url\": \"/api/get_complain_data/\",\n             \"type\": \"GET\",\n+            \n             \"dataSrc\": \"\",\n-            'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content'),\n         },\n         \"columns\": [{\n                 \"data\": \"\"\n             },\n"
                },
                {
                    "date": 1648112388602,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -26,9 +26,9 @@\n             \"url\": \"/api/get_complain_data/\",\n             \"type\": \"GET\",\n             \"headers\" : {\n                 'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content'),\n-            }\n+            },\n             \"dataSrc\": \"\",\n         },\n         \"columns\": [{\n                 \"data\": \"\"\n"
                }
            ],
            "date": 1648112032055,
            "name": "Commit-0",
            "content": "function gen_complain_code() {\n    var code = Math.random().toString(36).substring(2, 5) + Math.random().toString(36).substring(2, 5);\n    var d = new Date();\n    var date = d.getFullYear();\n    var prs = $(\"#ps option:selected\").data('ps_code');\n    $('#complainer_code').val(date + '/' + prs + '/' + code);\n}\n\nfunction load_complains() {\n    let url = '/api/complain_data';\n    let index = 1;\n    complain_list = $('#complain_tbl').DataTable({\n        \"destroy\": true,\n        \"processing\": true,\n        \"colReorder\": true,\n        \"serverSide\": false,\n        \"stateSave\": true,\n        \"pageLength\": 10,\n        rowReorder: {\n            selector: 'td:nth-child(2)'\n        },\n        responsive: true,\n        language: {\n            searchPlaceholder: \"Search...\"\n        },\n        \"ajax\": {\n            \"url\": \"/api/get_complain_data/\",\n            \"type\": \"GET\",\n            \"dataSrc\": \"\"\n            \n        },\n        \"columns\": [{\n                \"data\": \"\"\n            },\n            {\n                \"data\": \"complainer_code\",\n                \"defaultContent\": \"-\"\n            },\n            {\n                \"data\": \"complainer_name\",\n                \"defaultContent\": \"-\"\n            },\n            {\n                \"data\": \"comp_contact_no\",\n                \"defaultContent\": \"-\"\n            },\n            {\n                \"data\": \"id\"\n            }\n        ],\n        \"columnDefs\": [{\n                \"targets\": 0,\n                \"data\": \"0\",\n                \"render\": function() {\n                    return index++;\n                }\n            },\n            {\n                \"targets\": 4,\n                \"data\": \"0\",\n                \"render\": function(data, type, full, meta) {\n                    if (full['recieve_type'] == 1) {\n                        return \"<span class='bg-success p-1 rounded'>Call</span>\";\n                    } else if (full['recieve_type'] == 2) {\n                        return \"<span class='bg-success p-1 rounded'>Written</span>\";\n                    } else {\n                        return \"<span class='bg-success p-1 rounded'>Verbal</span>\";\n                    }\n                }\n            },\n            {\n                \"targets\": 5,\n                \"data\": \"0\",\n                \"render\": function(data, type, full, meta) {\n                    if (full['status'] == 1) {\n                        return \"<span class='bg-success p-1 rounded'>Completed</span>\";\n                    } else if (full['status'] == -1) {\n                        return \"<span class='bg-danger p-1 rounded'>Rejected</span>\";\n                    } else {\n                        return \"<span class='bg-warning p-1 rounded'>Pending</span>\";\n                    }\n                }\n            },\n            {\n                \"targets\": 6,\n                \"data\": \"0\",\n                \"render\": function(data, type, full, meta) {\n                    return getJtableBtnHtml(full);\n                }\n            }\n        ],\n        \"order\": [\n            [0, \"asc\"]\n        ],\n    });\n\n    // $(function() {\n    //     var t = $(\"#complain_tbl\").DataTable({\n\n    //     });\n    //     t.on('order.dt search.dt', function() {\n    //         t.column(0, {\n    //             search: 'applied',\n    //             order: 'applied'\n    //         }).nodes().each(function(cell, i) {\n    //             cell.innerHTML = i + 1;\n    //         });\n    //     }).draw();\n    // });\n\n    //data table error handling\n    $.fn.dataTable.ext.errMode = 'none';\n    $('#complain_tbl').on('error.dt', function(e, settings, techNote, message) {\n        console.log('DataTables error: ', message);\n    });\n}\n\n\n\nfunction getJtableBtnHtml(full) {\n    var html = '';\n    html += '<div class=\"btn-group\" role=\"group\"  aria-label=\"\" > ';\n    html += ' <button type=\"button\" class=\"btn btn-sm btn-primary btn-edit mr-1\" value=\"' + full[\"id\"] +\n        '\" data-toggle=\"tooltip\" title=\"Edit\"><i class=\"fas fa-edit\" aria-hidden=\"true\"></i></button>';\n    html += ' <a href=\"/complain_profile/id/' + full['id'] +\n        '\" class=\"btn btn-sm btn-success mr-1\" role=\"button\" data-toggle=\"tooltip\" title=\"profile\"><i class=\"fa fa-info-circle\" style=\"width: 10px\" aria-hidden=\"true\" alt=\"profile\"></i></a>';\n    html += ' <button type=\"button\" class=\"btn btn-sm btn-danger btn-del\" value=\"' + full[\"id\"] +\n        '\"data-toggle=\"tooltip\" title=\"Delete\"><i class=\"fa fa-trash\" aria-hidden=\"true\"></i></button>';\n    html += '</div>';\n    return html;\n}\n\nfunction save_complain() {\n    let url = '/api/save_complain';\n    let data = {\n        complainer_code: $('#complainer_code').val(),\n        complainer_name_ipt: $('#complainer_name_ipt').val(),\n        complainer_address_ipt: $('#complainer_address_ipt').val(),\n        contact_complainer_ipt: $('#contact_complainer_ipt').val(),\n        complain_desc_ipt: $('#complain_desc_ipt').val(),\n        recieve_type_ipt: $('#recieve_type_ipt').val(),\n        pradeshiya_saba_id: $('#ps').val(),\n    };\n    let arr = [];\n    let index = 0;\n    $.each($('#complain_attach')[0].files, function(key, val) {\n        arr[index++] = val;\n    });\n    ulploadFileWithData(url, data, function(resp) {\n        if (resp.status == 1) {\n            $('#complain_frm')[0].reset();\n            $('#complain_tbl').DataTable().ajax.reload();\n            gen_complain_code();\n            $('img').addClass('d-none');\n            swal.fire('success', 'Successfully save the complains', 'success');\n        } else {\n            swal.fire('failed', 'Complain saving is unsuccessful', 'warning');\n        }\n    }, false, arr);\n}\n\nfunction update_complain() {\n    let id = $('#hidden_id').val();\n    let url = '/api/update_complain/id/' + id;\n    let data = {\n        complainer_code: $('#complainer_code').val(),\n        complainer_name_ipt: $('#complainer_name_ipt').val(),\n        complainer_address_ipt: $('#complainer_address_ipt').val(),\n        contact_complainer_ipt: $('#contact_complainer_ipt').val(),\n        complain_desc_ipt: $('#complain_desc_ipt').val(),\n        recieve_type_ipt: $('#recieve_type_ipt').val(),\n        pradeshiya_saba_id: $('#ps').val(),\n    };\n    let arr = [];\n    let index = 0;\n    $.each($('#complain_attach')[0].files, function(key, val) {\n        arr[index++] = val;\n    });\n    ulploadFileWithData(url, data, function(resp) {\n        if (resp.status == 1) {\n            window.location.href = \"/complains\";\n            swal.fire('success', 'Successfully update the complains', 'success');\n        } else {\n            swal.fire('failed', 'Complain updating is unsuccessful', 'warning');\n        }\n    }, false, arr);\n}\n\nfunction delete_complain(id) {\n    let url = '/api/delete_complain/id/' + id;\n    ajaxRequest('DELETE', url, null, function(resp) {\n        if (resp.status == 1) {\n            $('#complain_tbl').DataTable().ajax.reload();\n            swal.fire('success', resp.msg, 'success');\n        } else {\n            swal.fire('failed', resp.msg, 'warning');\n        }\n    });\n}\n\nfunction loadPradeshiyaSabha(callBack) {\n    var cbo = \"\";\n    ajaxRequest('GET', \"/api/pradesheeyasabas\", null, function(dataSet) {\n        if (dataSet) {\n            $.each(dataSet, function(index, row) {\n                cbo += '<option value=\"' + row.id + '\" data-ps_code=\"' + row.code + '\">' + row.code + ' - ' + row.name + '</option>';\n            });\n        } else {\n            cbo = \"<option value=''>No Data Found</option>\";\n        }\n        $('#ps').html(cbo);\n        $('.select2').select2();\n        if (typeof callBack !== 'undefined' && callBack != null && typeof callBack === \"function\") {\n            callBack();\n        }\n    });\n}\n"
        }
    ]
}